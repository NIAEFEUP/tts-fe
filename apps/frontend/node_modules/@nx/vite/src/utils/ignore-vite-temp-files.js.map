{"version":3,"sources":["../../../../../packages/vite/src/utils/ignore-vite-temp-files.ts"],"sourcesContent":["import { ensurePackage, readJson, stripIndents, type Tree } from '@nx/devkit';\nimport { nxVersion } from './versions';\n\nexport async function ignoreViteTempFiles(\n  tree: Tree,\n  projectRoot?: string | undefined\n): Promise<void> {\n  addViteTempFilesToGitIgnore(tree);\n  await ignoreViteTempFilesInEslintConfig(tree, projectRoot);\n}\n\nexport function addViteTempFilesToGitIgnore(tree: Tree): void {\n  let gitIgnoreContents = tree.exists('.gitignore')\n    ? tree.read('.gitignore', 'utf-8')\n    : '';\n\n  if (!/^vite\\.config\\.\\*\\.timestamp\\*$/m.test(gitIgnoreContents)) {\n    gitIgnoreContents = stripIndents`${gitIgnoreContents}\n      vite.config.*.timestamp*`;\n  }\n  if (!/^vitest\\.config\\.\\*\\.timestamp\\*$/m.test(gitIgnoreContents)) {\n    gitIgnoreContents = stripIndents`${gitIgnoreContents}\n      vitest.config.*.timestamp*`;\n  }\n\n  tree.write('.gitignore', gitIgnoreContents);\n}\n\nasync function ignoreViteTempFilesInEslintConfig(\n  tree: Tree,\n  projectRoot: string | undefined\n): Promise<void> {\n  if (!isEslintInstalled(tree)) {\n    return;\n  }\n\n  ensurePackage('@nx/eslint', nxVersion);\n  const { addIgnoresToLintConfig, isEslintConfigSupported } = await import(\n    '@nx/eslint/src/generators/utils/eslint-file'\n  );\n  if (!isEslintConfigSupported(tree)) {\n    return;\n  }\n\n  const { useFlatConfig } = await import('@nx/eslint/src/utils/flat-config');\n  const isUsingFlatConfig = useFlatConfig(tree);\n  if (!projectRoot && !isUsingFlatConfig) {\n    // root eslintrc files ignore all files and the root eslintrc files add\n    // back all the project files, so we only add the ignores to the project\n    // eslintrc files\n    return;\n  }\n\n  // for flat config, we update the root config file\n  const directory = isUsingFlatConfig ? '' : projectRoot ?? '';\n\n  addIgnoresToLintConfig(tree, directory, [\n    '**/vite.config.*.timestamp*',\n    '**/vitest.config.*.timestamp*',\n  ]);\n}\n\nexport function isEslintInstalled(tree: Tree): boolean {\n  try {\n    require('eslint');\n    return true;\n  } catch {}\n\n  // it might not be installed yet, but it might be in the tree pending install\n  const { devDependencies, dependencies } = tree.exists('package.json')\n    ? readJson(tree, 'package.json')\n    : {};\n\n  return !!devDependencies?.['eslint'] || !!dependencies?.['eslint'];\n}\n"],"names":["addViteTempFilesToGitIgnore","ignoreViteTempFiles","isEslintInstalled","tree","projectRoot","ignoreViteTempFilesInEslintConfig","gitIgnoreContents","exists","read","test","stripIndents","write","ensurePackage","nxVersion","addIgnoresToLintConfig","isEslintConfigSupported","useFlatConfig","isUsingFlatConfig","directory","require","devDependencies","dependencies","readJson"],"rangeMappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;","mappings":";;;;;;;;IAWgBA,2BAA2B;eAA3BA;;IARMC,mBAAmB;eAAnBA;;IA2DNC,iBAAiB;eAAjBA;;;wBA9DiD;0BACvC;AAEnB,eAAeD,oBACpBE,IAAU,EACVC,WAAgC;IAEhCJ,4BAA4BG;IAC5B,MAAME,kCAAkCF,MAAMC;AAChD;AAEO,SAASJ,4BAA4BG,IAAU;IACpD,IAAIG,oBAAoBH,KAAKI,MAAM,CAAC,gBAChCJ,KAAKK,IAAI,CAAC,cAAc,WACxB;IAEJ,IAAI,CAAC,mCAAmCC,IAAI,CAACH,oBAAoB;QAC/DA,oBAAoBI,IAAAA,oBAAY,CAAA,CAAC,EAAEJ,kBAAkB;8BAC3B,CAAC;IAC7B;IACA,IAAI,CAAC,qCAAqCG,IAAI,CAACH,oBAAoB;QACjEA,oBAAoBI,IAAAA,oBAAY,CAAA,CAAC,EAAEJ,kBAAkB;gCACzB,CAAC;IAC/B;IAEAH,KAAKQ,KAAK,CAAC,cAAcL;AAC3B;AAEA,eAAeD,kCACbF,IAAU,EACVC,WAA+B;IAE/B,IAAI,CAACF,kBAAkBC,OAAO;QAC5B;IACF;IAEAS,IAAAA,qBAAa,EAAC,cAAcC,mBAAS;IACrC,MAAM,EAAEC,sBAAsB,EAAEC,uBAAuB,EAAE,GAAG,MAAM,2BAAA,QAChE;IAEF,IAAI,CAACA,wBAAwBZ,OAAO;QAClC;IACF;IAEA,MAAM,EAAEa,aAAa,EAAE,GAAG,MAAM,2BAAA,QAAO;IACvC,MAAMC,oBAAoBD,cAAcb;IACxC,IAAI,CAACC,eAAe,CAACa,mBAAmB;QACtC,uEAAuE;QACvE,wEAAwE;QACxE,iBAAiB;QACjB;IACF;IAEA,kDAAkD;IAClD,MAAMC,YAAYD,oBAAoB,KAAKb,sBAAAA,cAAe;IAE1DU,uBAAuBX,MAAMe,WAAW;QACtC;QACA;KACD;AACH;AAEO,SAAShB,kBAAkBC,IAAU;IAC1C,IAAI;QACFgB,QAAQ;QACR,OAAO;IACT,EAAE,UAAM,CAAC;IAET,6EAA6E;IAC7E,MAAM,EAAEC,eAAe,EAAEC,YAAY,EAAE,GAAGlB,KAAKI,MAAM,CAAC,kBAClDe,IAAAA,gBAAQ,EAACnB,MAAM,kBACf,CAAC;IAEL,OAAO,CAAC,EAACiB,mCAAAA,eAAiB,CAAC,SAAS,KAAI,CAAC,EAACC,gCAAAA,YAAc,CAAC,SAAS;AACpE"}