{"version":3,"sources":["../../../../../../../packages/vite/src/generators/convert-to-inferred/lib/preview-post-target-transformer.ts"],"sourcesContent":["import { type TargetConfiguration, type Tree } from '@nx/devkit';\nimport { getViteConfigPath } from './utils';\nimport { AggregatedLog } from '@nx/devkit/src/generators/plugin-migrations/aggregate-log-util';\n\nexport function previewPostTargetTransformer(migrationLogs: AggregatedLog) {\n  return (\n    target: TargetConfiguration,\n    tree: Tree,\n    projectDetails: { projectName: string; root: string },\n    inferredTargetConfiguration: TargetConfiguration\n  ) => {\n    const viteConfigPath = getViteConfigPath(tree, projectDetails.root);\n\n    if (target.options) {\n      removePropertiesFromTargetOptions(\n        target.options,\n        projectDetails.projectName,\n        migrationLogs\n      );\n    }\n\n    if (target.configurations) {\n      for (const configurationName in target.configurations) {\n        const configuration = target.configurations[configurationName];\n        removePropertiesFromTargetOptions(\n          configuration,\n          projectDetails.projectName,\n          migrationLogs\n        );\n      }\n\n      if (Object.keys(target.configurations).length === 0) {\n        if ('defaultConfiguration' in target) {\n          delete target.defaultConfiguration;\n        }\n        delete target.configurations;\n      }\n\n      if (\n        'defaultConfiguration' in target &&\n        !target.configurations[target.defaultConfiguration]\n      ) {\n        delete target.defaultConfiguration;\n      }\n    }\n\n    return target;\n  };\n}\n\nfunction removePropertiesFromTargetOptions(\n  targetOptions: any,\n  projectName: string,\n  migrationLogs: AggregatedLog\n) {\n  if ('buildTarget' in targetOptions) {\n    delete targetOptions.buildTarget;\n  }\n\n  if ('staticFilePath' in targetOptions) {\n    delete targetOptions.staticFilePath;\n  }\n\n  if ('proxyConfig' in targetOptions) {\n    migrationLogs.addLog({\n      executorName: '@nx/vite:preview-server',\n      project: projectName,\n      log: `Encountered 'proxyConfig' in project.json. You will need to copy the contents of this file to the 'server.proxy' property in your Vite config file.`,\n    });\n    delete targetOptions.proxyConfig;\n  }\n}\n"],"names":["previewPostTargetTransformer","migrationLogs","target","tree","projectDetails","inferredTargetConfiguration","viteConfigPath","getViteConfigPath","root","options","removePropertiesFromTargetOptions","projectName","configurations","configurationName","configuration","Object","keys","length","defaultConfiguration","targetOptions","buildTarget","staticFilePath","addLog","executorName","project","log","proxyConfig"],"rangeMappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;","mappings":";+BAIgBA;;;eAAAA;;;uBAHkB;AAG3B,SAASA,6BAA6BC,aAA4B;IACvE,OAAO,CACLC,QACAC,MACAC,gBACAC;QAEA,MAAMC,iBAAiBC,IAAAA,wBAAiB,EAACJ,MAAMC,eAAeI,IAAI;QAElE,IAAIN,OAAOO,OAAO,EAAE;YAClBC,kCACER,OAAOO,OAAO,EACdL,eAAeO,WAAW,EAC1BV;QAEJ;QAEA,IAAIC,OAAOU,cAAc,EAAE;YACzB,IAAK,MAAMC,qBAAqBX,OAAOU,cAAc,CAAE;gBACrD,MAAME,gBAAgBZ,OAAOU,cAAc,CAACC,kBAAkB;gBAC9DH,kCACEI,eACAV,eAAeO,WAAW,EAC1BV;YAEJ;YAEA,IAAIc,OAAOC,IAAI,CAACd,OAAOU,cAAc,EAAEK,MAAM,KAAK,GAAG;gBACnD,IAAI,0BAA0Bf,QAAQ;oBACpC,OAAOA,OAAOgB,oBAAoB;gBACpC;gBACA,OAAOhB,OAAOU,cAAc;YAC9B;YAEA,IACE,0BAA0BV,UAC1B,CAACA,OAAOU,cAAc,CAACV,OAAOgB,oBAAoB,CAAC,EACnD;gBACA,OAAOhB,OAAOgB,oBAAoB;YACpC;QACF;QAEA,OAAOhB;IACT;AACF;AAEA,SAASQ,kCACPS,aAAkB,EAClBR,WAAmB,EACnBV,aAA4B;IAE5B,IAAI,iBAAiBkB,eAAe;QAClC,OAAOA,cAAcC,WAAW;IAClC;IAEA,IAAI,oBAAoBD,eAAe;QACrC,OAAOA,cAAcE,cAAc;IACrC;IAEA,IAAI,iBAAiBF,eAAe;QAClClB,cAAcqB,MAAM,CAAC;YACnBC,cAAc;YACdC,SAASb;YACTc,KAAK,CAAC,mJAAmJ,CAAC;QAC5J;QACA,OAAON,cAAcO,WAAW;IAClC;AACF"}