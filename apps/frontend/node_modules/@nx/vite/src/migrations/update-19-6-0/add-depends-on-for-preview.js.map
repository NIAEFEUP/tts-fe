{"version":3,"sources":["../../../../../../packages/vite/src/migrations/update-19-6-0/add-depends-on-for-preview.ts"],"sourcesContent":["import {\n  type Tree,\n  formatFiles,\n  readProjectConfiguration,\n  updateProjectConfiguration,\n} from '@nx/devkit';\nimport { forEachExecutorOptions } from '@nx/devkit/src/generators/executor-options-utils';\nimport { VitePreviewServerExecutorOptions } from '../../executors/preview-server/schema';\n\nexport default async function (tree: Tree) {\n  forEachExecutorOptions<VitePreviewServerExecutorOptions>(\n    tree,\n    '@nx/vite:preview-server',\n    (_, projectName, targetName) => {\n      const project = readProjectConfiguration(tree, projectName);\n      project.targets[targetName].dependsOn ??= [];\n      if (project.targets[targetName].dependsOn.includes('build')) {\n        return;\n      }\n      project.targets[targetName].dependsOn.push('build');\n      updateProjectConfiguration(tree, projectName, project);\n    }\n  );\n\n  await formatFiles(tree);\n}\n"],"names":["tree","forEachExecutorOptions","_","projectName","targetName","project","readProjectConfiguration","targets","dependsOn","includes","push","updateProjectConfiguration","formatFiles"],"rangeMappings":";;;;;;;;;;;;;;;;;;;;;;","mappings":";+BASA;;;eAAA;;;wBAJO;sCACgC;AAGxB,eAAf,SAA+BA,IAAU;IACvCC,IAAAA,4CAAsB,EACpBD,MACA,2BACA,CAACE,GAAGC,aAAaC;YAEfC;QADA,MAAMA,UAAUC,IAAAA,gCAAwB,EAACN,MAAMG;;QAC/CE,eAAAA,8BAAAA,QAAQE,OAAO,CAACH,WAAW,EAACI,kCAA5BH,4BAA4BG,YAAc,EAAE;QAC5C,IAAIH,QAAQE,OAAO,CAACH,WAAW,CAACI,SAAS,CAACC,QAAQ,CAAC,UAAU;YAC3D;QACF;QACAJ,QAAQE,OAAO,CAACH,WAAW,CAACI,SAAS,CAACE,IAAI,CAAC;QAC3CC,IAAAA,kCAA0B,EAACX,MAAMG,aAAaE;IAChD;IAGF,MAAMO,IAAAA,mBAAW,EAACZ;AACpB"}