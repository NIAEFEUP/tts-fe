{"version":3,"sources":["../../../../../../packages/vite/src/migrations/update-20-5-0/eslint-ignore-vite-temp-files.ts"],"sourcesContent":["import {\n  ensurePackage,\n  formatFiles,\n  getProjects,\n  globAsync,\n  type Tree,\n} from '@nx/devkit';\nimport { isEslintInstalled } from '../../utils/ignore-vite-temp-files';\nimport { nxVersion } from '../../utils/versions';\n\nexport default async function (tree: Tree) {\n  if (!isEslintInstalled(tree)) {\n    return;\n  }\n\n  ensurePackage('@nx/eslint', nxVersion);\n  const { addIgnoresToLintConfig, isEslintConfigSupported } = await import(\n    '@nx/eslint/src/generators/utils/eslint-file'\n  );\n  if (!isEslintConfigSupported(tree)) {\n    return;\n  }\n\n  const { useFlatConfig } = await import('@nx/eslint/src/utils/flat-config');\n  const isUsingFlatConfig = useFlatConfig(tree);\n\n  if (isUsingFlatConfig) {\n    // using flat config, so we update the root eslint config\n    addIgnoresToLintConfig(tree, '', [\n      '**/vite.config.*.timestamp*',\n      '**/vitest.config.*.timestamp*',\n    ]);\n  } else {\n    // not using flat config, so we update each project's eslint config\n    const projects = getProjects(tree);\n\n    for (const [, { root: projectRoot }] of projects) {\n      const viteConfigFiles = await globAsync(tree, [\n        `${projectRoot}/**/{vite,vitest}.config.{js,ts,mjs,mts,cjs,cts}`,\n      ]);\n      if (!viteConfigFiles.length) {\n        // the project doesn't use vite or vitest, so we skip it\n        continue;\n      }\n\n      addIgnoresToLintConfig(tree, projectRoot, [\n        '**/vite.config.*.timestamp*',\n        '**/vitest.config.*.timestamp*',\n      ]);\n    }\n  }\n\n  await formatFiles(tree);\n}\n"],"names":["tree","isEslintInstalled","ensurePackage","nxVersion","addIgnoresToLintConfig","isEslintConfigSupported","useFlatConfig","isUsingFlatConfig","projects","getProjects","root","projectRoot","viteConfigFiles","globAsync","length","formatFiles"],"rangeMappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;","mappings":";+BAUA;;;eAAA;;;wBAJO;qCAC2B;0BACR;AAEX,eAAf,SAA+BA,IAAU;IACvC,IAAI,CAACC,IAAAA,sCAAiB,EAACD,OAAO;QAC5B;IACF;IAEAE,IAAAA,qBAAa,EAAC,cAAcC,mBAAS;IACrC,MAAM,EAAEC,sBAAsB,EAAEC,uBAAuB,EAAE,GAAG,MAAM,2BAAA,QAChE;IAEF,IAAI,CAACA,wBAAwBL,OAAO;QAClC;IACF;IAEA,MAAM,EAAEM,aAAa,EAAE,GAAG,MAAM,2BAAA,QAAO;IACvC,MAAMC,oBAAoBD,cAAcN;IAExC,IAAIO,mBAAmB;QACrB,yDAAyD;QACzDH,uBAAuBJ,MAAM,IAAI;YAC/B;YACA;SACD;IACH,OAAO;QACL,mEAAmE;QACnE,MAAMQ,WAAWC,IAAAA,mBAAW,EAACT;QAE7B,KAAK,MAAM,GAAG,EAAEU,MAAMC,WAAW,EAAE,CAAC,IAAIH,SAAU;YAChD,MAAMI,kBAAkB,MAAMC,IAAAA,iBAAS,EAACb,MAAM;gBAC5C,CAAC,EAAEW,YAAY,gDAAgD,CAAC;aACjE;YACD,IAAI,CAACC,gBAAgBE,MAAM,EAAE;gBAE3B;YACF;YAEAV,uBAAuBJ,MAAMW,aAAa;gBACxC;gBACA;aACD;QACH;IACF;IAEA,MAAMI,IAAAA,mBAAW,EAACf;AACpB"}