{"version":3,"file":"whenIdle.js","sources":["../../../../../src/metrics/web-vitals/lib/whenIdle.ts"],"sourcesContent":["/*\n * Copyright 2024 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     https://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { WINDOW } from '../../../types';\nimport { onHidden } from './onHidden';\nimport { runOnce } from './runOnce';\n\n/**\n * Runs the passed callback during the next idle period, or immediately\n * if the browser's visibility state is (or becomes) hidden.\n */\nexport const whenIdle = (cb: () => void): number => {\n  const rIC = WINDOW.requestIdleCallback || WINDOW.setTimeout;\n\n  let handle = -1;\n  // eslint-disable-next-line no-param-reassign\n  cb = runOnce(cb) as () => void;\n  // If the document is hidden, run the callback immediately, otherwise\n  // race an idle callback with the next `visibilitychange` event.\n  if (WINDOW.document && WINDOW.document.visibilityState === 'hidden') {\n    cb();\n  } else {\n    handle = rIC(cb);\n    onHidden(cb);\n  }\n  return handle;\n};\n"],"names":["WINDOW","runOnce","onHidden"],"mappings":";;;;;;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AAMA;AACA;AACA;AACA;AACa,MAAA,QAAA,GAAW,CAAC,EAAE,KAAyB;AACpD,EAAE,MAAM,MAAMA,YAAM,CAAC,mBAAoB,IAAGA,YAAM,CAAC,UAAU;;AAE7D,EAAE,IAAI,MAAA,GAAS,CAAC,CAAC;AACjB;AACA,EAAE,EAAG,GAAEC,eAAO,CAAC,EAAE,CAAE;AACnB;AACA;AACA,EAAE,IAAID,YAAM,CAAC,QAAS,IAAGA,YAAM,CAAC,QAAQ,CAAC,eAAgB,KAAI,QAAQ,EAAE;AACvE,IAAI,EAAE,EAAE;AACR,SAAS;AACT,IAAI,MAAO,GAAE,GAAG,CAAC,EAAE,CAAC;AACpB,IAAIE,iBAAQ,CAAC,EAAE,CAAC;AAChB;AACA,EAAE,OAAO,MAAM;AACf;;;;"}